#!/bin/bash

# Usage: script/sync
# Sync all branches and tags to public (public:heyverse/hey) repo.

set -e

PUBLIC_NAME="public"
PUBLIC_REPO="git@github.com:heyverse/hey.git"

# Add public remote if not exists
if ! git remote get-url $PUBLIC_NAME &>/dev/null; then
  echo "ðŸ”§ Adding public remote..."
  git remote add $PUBLIC_NAME $PUBLIC_REPO
fi

echo "ðŸš€ Syncing all branches to public repo..."
for branch in $(git for-each-ref --format='%(refname:short)' refs/heads/); do
  echo "â†’ Pushing branch: $branch"
  git push $PUBLIC_NAME "$branch" --force
done

echo "ðŸš€ Syncing all tags to public repo..."
for tag in $(git tag); do
  echo "â†’ Pushing tag: $tag"
  git push $PUBLIC_NAME "refs/tags/$tag" --force
done

echo "âœ… Fully synced all branches and tags to public repo"
